class e{constructor(e={}){this.events={},this.eventCache={},this.options={enableCache:!1!==e.enableCache,maxCacheSize:e.maxCacheSize||10,clearCacheAfterSubscribe:!1!==e.clearCacheAfterSubscribe,...e}}on(e,t,s={}){if("function"!=typeof t)throw new TypeError("回调函数必须是函数类型");this.events[e]||(this.events[e]=[]);const n={callback:t,once:!!s.once};return this.events[e].push(n),this.options.enableCache&&this.eventCache[e]&&([...this.eventCache[e]].forEach(s=>{try{t(...s.args)}catch(t){console.error(`EventBus 缓存事件 "${e}" 回调执行出错:`,t)}n.once&&this.off(e,t)}),this.options.clearCacheAfterSubscribe&&delete this.eventCache[e]),()=>this.off(e,t)}once(e,t){return this.on(e,t,{once:!0})}off(e,t){if(this.events[e]){if(!t)return void delete this.events[e];this.events[e]=this.events[e].filter(e=>e.callback!==t),0===this.events[e].length&&delete this.events[e]}}emit(e,...t){let s=!1;if(this.events[e]&&(s=!0,[...this.events[e]].forEach(s=>{try{s.callback(...t)}catch(t){console.error(`EventBus 事件 "${e}" 回调执行出错:`,t)}s.once&&this.off(e,s.callback)})),!s&&this.options.enableCache&&(this.eventCache[e]||(this.eventCache[e]=[]),this.eventCache[e].push({args:[...t],timestamp:Date.now()}),this.options.maxCacheSize>0)){const t=this.eventCache[e].length-this.options.maxCacheSize;t>0&&this.eventCache[e].splice(0,t)}}listenerCount(e){return this.events[e]?this.events[e].length:0}cacheCount(e){return this.eventCache[e]?this.eventCache[e].length:0}clear(e=!0){this.events={},e&&this.clearCache()}clearCache(e){e?delete this.eventCache[e]:this.eventCache={}}getEvents(){return Object.keys(this.events)}getCachedEvents(){return Object.keys(this.eventCache)}getOptions(){return{...this.options}}updateOptions(e){this.options={...this.options,...e}}}let t=new e;const s={install:function(s,n={}){n.eventBusOptions&&(t=new e(n.eventBusOptions)),s.provide("eventBus",t),s.config.globalProperties.$eventBus=t,n.debug&&console.log("Vue 3 EventBus 已安装",{options:n})}},n=t;export{e as EventBus,s as default,n as eventBus};
