<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>vue2.7 指令</title>

    <script src="https://unpkg.com/vue@2.7.14/dist/vue.js"></script>
    <script type="module">
        // 动态导入，确保在浏览器环境中可用
        import LazyLoad from '../src/img-lazy.js';
        window.LazyLoad = LazyLoad;
    </script>

    <style>
        .lazy-img {
            width: 500px;
            height: 500px;
        }
    </style>
</head>
<body>
    <div id="app">
        <p v-text="message"></p>
        <p v-html2="html"></p>

        <input type="text" v-focus :value="inpMesg"></input>

        <button v-throttle="1000" @click="submiHandle">提交</button>

        <div id="img-box">
             <img  v-for="item in imgs" :key="item.id" class="lazy-img" v-lazy="item.img" alt="">
        </div>
    </div>
    <script>
        Vue.use(window.LazyLoad);

        // 全局自定义组件
        Vue.directive('focus', {
            // inserted: 这个钩子作用被绑定元素插⼊⽗节点时调⽤ (仅保证⽗节点存在，但不⼀定已被插⼊⽂档中)
            inserted(el, binding) {
                console.log('v-focus', el,binding); // el: input  binding: {value: 'hello vue'}
                el.focus() // 初始化聚焦
            },
            // update: 所在组件的 VNode 更新时调⽤，但是可能发⽣在其⼦ VNode 更新之前。指令的
            //值可能发⽣了改变，也可能没有。但是你可以通过⽐较更新前后的值来忽略不必要的模板更新
            update(el, binding) {
                console.log('v-focus-update', el,binding);
            },
            // componentUpdated: 指令所在组件的 VNode 及其⼦ VNode 全部更新后调⽤
            componentUpdated(el, binding) {
                console.log('v-focus-componentUpdated', el,binding);
            },
            // unbind: 只在指令与元素解除绑定时调用
            unbind(el, binding) {
                console.log('v-focus-unbind', el,binding);
            },
            // bind: 只在指令与元素成功绑定时调用
            bind(el, binding) {
                console.log('v-focus-bind', el,binding);
            }
        })


        // 指令：v-text
        // 作用：将数据渲染到标签中
        new Vue({
            el: '#app',
            data: {
                inpMesg: 1,
                message: 'hello vue',
                html: '<span style="color: red;">hello vue</span>',
                imgs: [
                    {id: 1, img: 'https://img2.baidu.com/it/u=3422222222,2838888888&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500'},
                    {id: 2, img: 'https://img2.baidu.com/it/u=3422222222,2838888888&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500'},
                    {id: 3, img: 'https://img2.baidu.com/it/u=3422222222,2838888888&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500'},
                    {id: 4, img: 'https://img2.baidu.com/it/u=3422222222,2838888888&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500'},
                    {id: 5, img: 'https://img2.baidu.com/it/u=3422222222,2838888888&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500'},
                    {id: 6, img: 'https://img2.baidu.com/it/u=3422222222,2838888888&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500'},
                    {id: 7, img: 'https://img2.baidu.com/it/u=3422222222,2838888888&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500'},
                    {id: 8, img: 'https://img2.baidu.com/it/u=3422222222,2838888888&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500'},

                    {id: 19, img: 'https://img2.baidu.com/it/u=3422222222,2838888888&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500'},
                    {id: 20, img: 'https://img2.baidu.com/it/u=3422222222,2838888888&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500'},
                    {id: 31, img: 'https://img2.baidu.com/it/u=3422222222,2838888888&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500'},
                    {id: 42, img: 'https://img2.baidu.com/it/u=3422222222,2838888888&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500'},
                    {id: 53, img: 'https://img2.baidu.com/it/u=3422222222,2838888888&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500'},
                    {id: 60, img: 'https://img2.baidu.com/it/u=3422222222,2838888888&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500'},
                    {id: 17, img: 'https://img2.baidu.com/it/u=3422222222,2838888888&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500'},
                    {id: 89, img: 'https://img2.baidu.com/it/u=3422222222,2838888888&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500'},

                    {id: 90, img: 'https://img2.baidu.com/it/u=3422222222,2838888888&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500'},
                    {id: 200, img: 'https://img2.baidu.com/it/u=3422222222,2838888888&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500'},
                    {id: 310, img: 'https://img2.baidu.com/it/u=3422222222,2838888888&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500'},
                    {id: 420, img: 'https://img2.baidu.com/it/u=3422222222,2838888888&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500'},
                    {id: 530, img: 'https://img2.baidu.com/it/u=3422222222,2838888888&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500'},
                    {id: 600, img: 'https://img2.baidu.com/it/u=3422222222,2838888888&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500'},
                    {id: 170, img: 'https://img2.baidu.com/it/u=3422222222,2838888888&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500'},
                    {id: 890, img: 'https://img2.baidu.com/it/u=3422222222,2838888888&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500'},

                ]
            },
            // 自定义指令 局部
            // v-text
            directives: {
                text: {
                    inserted(el, binding) {
                        console.log('v-text2', el,binding);
                        // 作用：将数据渲染到标签中
                        el.textContent = binding.value
                    }
                },
                // v-html2
                html2: {
                    inserted(el, binding) {
                        console.log('v-html', el,binding);
                        // 作用：将数据渲染到标签中
                        el.innerHTML = binding.value
                    }
                },
                // 表单防止1s秒内多次点击重复提交
                throttle: {
                    bind: function(el, binding) {
                        // 获取传入节流时间
                        let time = binding.value || 1000;
                        // 定时器
                        let timer = null;
                        el.addEventListener('click', event => { 
                            if (timer) {
                                // 停止事件传播
                                event && event.stopImmediatePropagation();
                                return;
                            }
                            timer = setTimeout(() => {
                                timer = null;
                            }, time);
                        },true)
                    }
                },
            
            },
            methods: {
                submiHandle() {
                    console.log('提交');
                }
            }
        })
    </script>
</body>
</html>